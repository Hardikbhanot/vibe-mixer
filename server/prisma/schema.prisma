generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password_hash String
  created_at    DateTime       @default(now())
  
  
  swipes        SwipeHistory[]
  playlists     Playlist[]    

  // Social Profile Fields
  username      String?        @unique
  isPublic      Boolean        @default(false)
  isMatchable   Boolean        @default(false)
  bio           String?
  avatarUrl     String?        // Base64 string for profile picture
  vibeTags      Json?          // AI generated vibe tags
  topArtists    Json?          // Cached list of top artists { name, image, id }
  topTracks     Json?          // Cached list of top tracks { name, artist, image, id }


  // Relations
  matchesAsA    Match[]        @relation("UserMatchesA")
  matchesAsB    Match[]        @relation("UserMatchesB")
  likes         Like[]
  awards        Award[]
}

model Match {
  id        String   @id @default(uuid())
  userAId   String
  userBId   String
  score     Float    // Compatibility score (0-100)
  status    MatchStatus @default(PENDING)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  userA     User     @relation("UserMatchesA", fields: [userAId], references: [id])
  userB     User     @relation("UserMatchesB", fields: [userBId], references: [id])

  @@unique([userAId, userBId]) // Prevent duplicate match pairs
}

enum MatchStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model SwipeHistory {
  id         String   @id @default(uuid())
  userId     String
  songName   String
  artistName String
  action     Action
  created_at DateTime @default(now())
  
  user       User     @relation(fields: [userId], references: [id])
}


model Playlist {
  id          String   @id @default(uuid())
  name        String
  description String?
  coverImage  String?
  mood        String?
  isPublic    Boolean  @default(false) 
  
  tracks      Json     
  
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  createdAt   DateTime @default(now())

  // Engagement stats
  saveCount   Int      @default(0)
  plays       Int      @default(0)
  likes       Like[]
}

model Like {
  id         String   @id @default(uuid())
  userId     String
  playlistId String
  createdAt  DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id])
  playlist   Playlist @relation(fields: [playlistId], references: [id])

  @@unique([userId, playlistId])
}

model Award {
  id          String   @id @default(uuid())
  userId      String
  type        String   // FIRST_LIKE, POPULAR_CREATOR, etc.
  name        String
  description String
  icon        String   // Material Icon name
  awardedAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id])
}

enum Action {
  LIKE
  DISLIKE
  SUPERLIKE
}